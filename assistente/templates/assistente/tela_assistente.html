{% load static %}
<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <title>SmartHVAC Assist â€“ Tela do Assistente</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" type="image/png" href="{% static 'images/favicon-smarthvac.png' %}">

    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="{% static 'assistente/css/assistente.css' %}" rel="stylesheet">
</head>

<body>
<div class="app-wrapper">
<div class="app-card">

    <!-- HEADER -->
    <div class="app-header">
        <div class="app-header-icon">
            <img src="{% static 'images/logo_smarthvac.png' %}" alt="logo SmartHVAC Assist">
        </div>
        <div>
            <div class="small fw-semibold">SmartHVAC Assist</div>
            <div class="small text-secondary">Assistente de diagnÃ³stico em HVAC</div>
        </div>
        <div class="ms-auto">
            <span class="badge-hvac">MVP</span>
        </div>
    </div>

    <!-- STATUS -->
    <div class="app-status-bar px-3 py-2">
        <div class="d-flex justify-content-between small">
            <div><strong>Plano:</strong> {{ plano }}</div>
            <div><strong>Usos:</strong> {{ usos_hoje }} / {{ limite_hoje }}</div>
        </div>
        <div class="d-flex justify-content-between small mt-1">
            <div>
                <strong>MemÃ³ria:</strong>
                {% if memoria_ativa %}
                    <span class="text-success">Ativa</span>
                {% else %}
                    <span class="text-danger">Inativa</span>
                {% endif %}
            </div>
            <div>
                {% if not memoria_ativa %}
                    <a href="#upgrade" class="text-warning fw-semibold text-decoration-none">
                        Upgrade PRO â†’
                    </a>
                {% else %}
                    <span class="text-muted">Pagamento OK</span>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- BODY -->
    <div class="app-body">

        <!-- MENSAGEM INICIAL -->
        <div class="msg msg-assistant">
            <div class="msg-author">SmartHVAC Assist</div>
            <div class="bubble">
                OlÃ¡! Me diga o contexto da mÃ¡quina e os sintomas que vocÃª estÃ¡ vendo em campo
                para eu ajudar no diagnÃ³stico.
            </div>
        </div>

        <!-- FORM -->
        <form method="post">
            {% csrf_token %}

            <!-- CAMPOS -->
            <div class="mb-2">
                <label class="form-label">Tipo de equipamento</label>
                <select class="form-select form-select-sm" name="tipo_equipamento">
                    <option value="split_hi_wall" {% if tipo_equipamento == "split_hi_wall" %}selected{% endif %}>Split Hi-Wall</option>
                    <option value="piso_teto" {% if tipo_equipamento == "piso_teto" %}selected{% endif %}>Piso Teto</option>
                    <option value="cassete" {% if tipo_equipamento == "cassete" %}selected{% endif %}>Cassete</option>
                    <option value="freezer_farmaceutico" {% if tipo_equipamento == "freezer_farmaceutico" %}selected{% endif %}>Freezer farmacÃªutico</option>
                    <option value="camara_fria" {% if tipo_equipamento == "camara_fria" %}selected{% endif %}>CÃ¢mara fria</option>
                </select>
            </div>

            <div class="mb-2">
                <label class="form-label">Marca do equipamento</label>
                <input type="text" class="form-control form-control-sm"
                       name="marca_equipamento"
                       value="{{ marca_equipamento }}">
            </div>

            <div class="mb-3">
                <label class="form-label">Sintomas</label>
                <textarea class="form-control form-control-sm"
                          name="sintomas"
                          rows="3">{{ sintomas }}</textarea>
            </div>

            <!-- CHAT -->
            {% if resposta_exemplo %}
            <div class="chat-area">

                <div class="msg msg-user">
                    <div class="msg-author">VocÃª</div>
                    <div class="bubble bubble-user">
                        {{ sintomas }}
                    </div>
                </div>

   <div class="msg msg-assistant">
  <div class="msg-author">SmartHVAC Assist</div>

  {% if memoria_ativa %}
    <div class="bubble bubble-assistant" id="textoRespostaIA">
      {{ resposta_exemplo|linebreaksbr }}
    </div>

    <button type="button"
            class="btn btn-sm btn-outline-light mt-2"
            onclick="copiarResposta()">
      Copiar texto
    </button>

    <small class="text-muted d-block mt-1">
      MemÃ³ria ativa por 48h (Plano PRO).
    </small>

  {% else %}
    <div class="bubble bubble-assistant">
      {{ resposta_exemplo|linebreaksbr }}
    </div>

    <small class="text-light d-block mt-2">
      No plano <a href="#upgrade" class="text-warning fw-semibold text-decoration-none">PRO</a> vocÃª libera:
      memÃ³ria 48h, copiar com 1 clique e texto pronto para OS/PMOC.
    </small>
  {% endif %}
</div>


            </div>
            {% endif %}

            <!-- AÃ‡Ã•ES -->
            <div class="send-area mt-3">
                <button type="submit" name="acao" value="diagnostico"
                        class="btn btn-send w-100 mb-2">
                    Gerar diagnÃ³stico
                </button>

                <div class="d-flex gap-2">
                    <button type="button"
                            class="btn btn-outline-secondary w-100 btn-locked"
                            {% if memoria_ativa %}disabled{% endif %}>
                        ðŸ”’ Copiar texto para OS
                    </button>

                    <button type="button"
                            class="btn btn-outline-secondary w-100 btn-locked"
                            {% if memoria_ativa %}disabled{% endif %}>
                        ðŸ”’ Copiar texto para PMOC
                    </button>
                </div>
            </div>

        </form>
    </div>
</div>

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
function copiarResposta() {
    const el = document.getElementById("textoRespostaIA");
    if (!el) return;
    navigator.clipboard.writeText(el.innerText || el.textContent);
}
</script>
{% if not memoria_ativa %}
<script>
document.addEventListener('contextmenu', function(e) {
    e.preventDefault();
});
</script>
{% endif %}


</body>
</html>
